var h=void 0,k=!0,l=null,m=!1;function n(){return function(){}}function aa(a){return function(){return this[a]}}var o,q=this;function ba(a,b){var c=a.split("."),d=q;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)!c.length&&b!==h?d[f]=b:d=d[f]?d[f]:d[f]={}}
function ca(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function da(a){return"array"==ca(a)}function ea(a){var b=ca(a);return"array"==b||"object"==b&&"number"==typeof a.length}function t(a){return"string"==typeof a}function u(a){return"function"==ca(a)}function fa(a){var b=typeof a;return"object"==b&&a!=l||"function"==b}var ga="closure_uid_"+Math.floor(2147483648*Math.random()).toString(36),ha=0;function ia(a,b,c){return a.call.apply(a.bind,arguments)}
function ja(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function ka(a,b,c){ka=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ia:ja;return ka.apply(l,arguments)}
function la(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=Array.prototype.slice.call(arguments);b.unshift.apply(b,c);return a.apply(this,b)}}function ma(a,b){function c(){}c.prototype=b.prototype;a.Sb=b.prototype;a.prototype=new c;a.prototype.constructor=a};function na(a,b){this.x=a;this.y=b};function oa(a){this.points=a}function pa(a){for(var b=0,c=a.length-1,d=0;d<a.length;d++)b+=(a[c].x+a[d].x)*(a[c].y-a[d].y),c=d;return b/2}
function qa(a,b){var c,d;d=c=0;for(var f,e=a.length-1,g=0;g<a.length;g++)f=a[g].x*a[e].y-a[e].x*a[g].y,c+=(a[g].x+a[e].x)*f,d+=(a[g].y+a[e].y)*f,e=g;f=6*pa(a);c=Math.abs(c/f);d=Math.abs(d/f);f=[];for(e=0;e<a.length;e++){var g=a[e],j=(0>pa(a)?-1:1)*b,i=g.x-c,p=g.y-d,A=0<j?1:0>j?-1:0,j=Math.sqrt(Math.pow(j,2)/(1+Math.pow(i/p,2)));f.push({x:g.x+Math.abs(i/p*j)*(0<i?1:0>i?-1:0)*A,y:g.y+Math.abs(j)*(0<p?1:0>p?-1:0)*A})}return f};function ra(a,b,c,d){0<c?(this.x=a,this.width=c):(this.x=a+c,this.width=-c);0<d?(this.y=b,this.height=d):(this.y=b+d,this.height=-d)};function sa(a,b){this.type=a;this.geometry=b}function xa(a){return"rect"==a.type?a.geometry.width*a.geometry.height:"polygon"==a.type?Math.abs(pa(a.geometry.points)):0}function ya(a){if("rect"==a.type)return a;if("polygon"==a.type){for(var a=a.geometry.points,b=a[0].x,c=a[0].x,d=a[0].y,f=a[0].y,e=1;e<a.length;e++)a[e].x>c&&(c=a[e].x),a[e].x<b&&(b=a[e].x),a[e].y>f&&(f=a[e].y),a[e].y<d&&(d=a[e].y);return new sa("rect",new ra(b,d,c-b,f-d))}}
function za(a,b){var c;c=a.geometry.points;var d=0>pa(c)?-1:1;if(4>c.length)c=qa(c,d*b);else{for(var f=c.length-1,e=1,g=[],j=0;j<c.length;j++)f=qa([c[f],c[j],c[e]],d*b),g.push(f[1]),f=j,e++,e>c.length-1&&(e=0);c=g}return new sa("polygon",new oa(c))}
function Aa(a,b){if("rect"==a.type){var c=a.geometry,d=b({x:c.x,y:c.y}),c=b({x:c.x+c.width,y:c.y+c.height});return new sa("rect",new ra(d.x,d.y,c.x-d.x,c.y-d.y))}if("polygon"==a.type){var f=[];v(a.geometry.points,function(a){f.push(b(a))});return new sa("polygon",new oa(f))}}function Ba(a){return JSON.stringify(a.geometry)}window.annotorious||(window.annotorious={});window.annotorious.geometry||(window.annotorious.geometry={},window.annotorious.geometry.expand=za);function Ca(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")}function Da(a){if(!Ea.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(Fa,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(Ga,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(Ha,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(Ia,"&quot;"));return a}var Fa=/&/g,Ga=/</g,Ha=/>/g,Ia=/\"/g,Ea=/[&<>\"]/,Ma={};function Na(a){return Ma[a]||(Ma[a]=(""+a).replace(/\-([a-z])/g,function(a,c){return c.toUpperCase()}))};var w=Array.prototype,Oa=w.indexOf?function(a,b,c){return w.indexOf.call(a,b,c)}:function(a,b,c){c=c==l?0:0>c?Math.max(0,a.length+c):c;if(t(a))return!t(b)||1!=b.length?-1:a.indexOf(b,c);for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},v=w.forEach?function(a,b,c){w.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,f=t(a)?a.split(""):a,e=0;e<d;e++)e in f&&b.call(c,f[e],e,a)},Pa=w.filter?function(a,b,c){return w.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,f=[],e=0,g=t(a)?a.split(""):
a,j=0;j<d;j++)if(j in g){var i=g[j];b.call(c,i,j,a)&&(f[e++]=i)}return f},Qa=w.map?function(a,b,c){return w.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,f=Array(d),e=t(a)?a.split(""):a,g=0;g<d;g++)g in e&&(f[g]=b.call(c,e[g],g,a));return f};function B(a,b){var c;a:{c=a.length;for(var d=t(a)?a.split(""):a,f=0;f<c;f++)if(f in d&&b.call(h,d[f],f,a)){c=f;break a}c=-1}return 0>c?l:t(a)?a.charAt(c):a[c]}function C(a,b){var c=Oa(a,b);0<=c&&w.splice.call(a,c,1)}
function Ra(a){return w.concat.apply(w,arguments)}function Sa(a){if(da(a))return Ra(a);for(var b=[],c=0,d=a.length;c<d;c++)b[c]=a[c];return b}function Ta(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c],f;if(da(d)||(f=ea(d))&&d.hasOwnProperty("callee"))a.push.apply(a,d);else if(f)for(var e=a.length,g=d.length,j=0;j<g;j++)a[e+j]=d[j];else a.push(d)}}function Ua(a,b,c,d){w.splice.apply(a,Va(arguments,1))}
function Va(a,b,c){return 2>=arguments.length?w.slice.call(a,b):w.slice.call(a,b,c)}function Wa(a,b){w.sort.call(a,b||Xa)}function Xa(a,b){return a>b?1:a<b?-1:0};var Ya,Za,$a,ab,bb;function cb(){return q.navigator?q.navigator.userAgent:l}function db(){return q.navigator}ab=$a=Za=Ya=m;var eb;if(eb=cb()){var fb=db();Ya=0==eb.indexOf("Opera");Za=!Ya&&-1!=eb.indexOf("MSIE");$a=!Ya&&-1!=eb.indexOf("WebKit");ab=!Ya&&!$a&&"Gecko"==fb.product}var gb=Ya,D=Za,E=ab,I=$a,jb=db();bb=-1!=(jb&&jb.platform||"").indexOf("Mac");var kb=!!db()&&-1!=(db().appVersion||"").indexOf("X11"),lb;
a:{var mb="",nb;if(gb&&q.opera)var ob=q.opera.version,mb="function"==typeof ob?ob():ob;else if(E?nb=/rv\:([^\);]+)(\)|;)/:D?nb=/MSIE\s+([^\);]+)(\)|;)/:I&&(nb=/WebKit\/(\S+)/),nb)var pb=nb.exec(cb()),mb=pb?pb[1]:"";if(D){var qb,rb=q.document;qb=rb?rb.documentMode:h;if(qb>parseFloat(mb)){lb=""+qb;break a}}lb=mb}var sb={};
function J(a){var b;if(!(b=sb[a])){b=0;for(var c=Ca(""+lb).split("."),d=Ca(""+a).split("."),f=Math.max(c.length,d.length),e=0;0==b&&e<f;e++){var g=c[e]||"",j=d[e]||"",i=RegExp("(\\d*)(\\D*)","g"),p=RegExp("(\\d*)(\\D*)","g");do{var A=i.exec(g)||["","",""],r=p.exec(j)||["","",""];if(0==A[0].length&&0==r[0].length)break;b=((0==A[1].length?0:parseInt(A[1],10))<(0==r[1].length?0:parseInt(r[1],10))?-1:(0==A[1].length?0:parseInt(A[1],10))>(0==r[1].length?0:parseInt(r[1],10))?1:0)||((0==A[2].length)<(0==
r[2].length)?-1:(0==A[2].length)>(0==r[2].length)?1:0)||(A[2]<r[2]?-1:A[2]>r[2]?1:0)}while(0==b)}b=sb[a]=0<=b}return b}var tb={};function ub(a){return tb[a]||(tb[a]=D&&!!document.documentMode&&document.documentMode>=a)};var vb,wb=!D||ub(9);!E&&!D||D&&ub(9)||E&&J("1.9.1");D&&J("9");var xb=D||gb||I;function yb(a){return(a=a.className)&&"function"==typeof a.split?a.split(/\s+/):[]}function zb(a,b){var c=yb(a),d=Va(arguments,1),d=Ab(c,d);a.className=c.join(" ");return d}function Bb(a,b){var c=yb(a),d=Va(arguments,1);Cb(c,d);a.className=c.join(" ")}function Ab(a,b){for(var c=0,d=0;d<b.length;d++)0<=Oa(a,b[d])||(a.push(b[d]),c++);return c==b.length}function Cb(a,b){for(var c=0,d=0;d<a.length;d++)0<=Oa(b,a[d])&&(Ua(a,d--,1),c++)}
function Db(a,b,c){var d=yb(a);t(b)?C(d,b):da(b)&&Cb(d,b);t(c)&&!(0<=Oa(d,c))?d.push(c):da(c)&&Ab(d,c);a.className=d.join(" ")};function Eb(a,b){this.x=a!==h?a:0;this.y=b!==h?b:0};function Fb(a,b){this.width=a;this.height=b}Fb.prototype.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};Fb.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function Gb(a,b){for(var c in a)b.call(h,a[c],c,a)}var Hb="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",");function Ib(a,b){for(var c,d,f=1;f<arguments.length;f++){d=arguments[f];for(c in d)a[c]=d[c];for(var e=0;e<Hb.length;e++)c=Hb[e],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};function Jb(a){return a?new Kb(Lb(a)):vb||(vb=new Kb)}function Mb(a,b){Gb(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:d in Nb?a.setAttribute(Nb[d],b):0==d.lastIndexOf("aria-",0)?a.setAttribute(d,b):a[d]=b})}var Nb={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",height:"height",width:"width",usemap:"useMap",frameborder:"frameBorder",maxlength:"maxLength",type:"type"};
function Qb(a){var b=!I?a.documentElement:a.body,a=a.parentWindow||a.defaultView;return new Eb(a.pageXOffset||b.scrollLeft,a.pageYOffset||b.scrollTop)}
function Rb(a,b,c){var d=arguments,f=document,e=d[0],g=d[1];if(!wb&&g&&(g.name||g.type)){e=["<",e];g.name&&e.push(' name="',Da(g.name),'"');if(g.type){e.push(' type="',Da(g.type),'"');var j={};Ib(j,g);g=j;delete g.type}e.push(">");e=e.join("")}e=f.createElement(e);g&&(t(g)?e.className=g:da(g)?zb.apply(l,[e].concat(g)):Mb(e,g));2<d.length&&Sb(f,e,d,2);return e}
function Sb(a,b,c,d){function f(c){c&&b.appendChild(t(c)?a.createTextNode(c):c)}for(;d<c.length;d++){var e=c[d];ea(e)&&!(fa(e)&&0<e.nodeType)?v(Tb(e)?Sa(e):e,f):f(e)}}function Ub(a){for(var b;b=a.firstChild;)a.removeChild(b)}function Vb(a,b){var c=b.parentNode;c&&c.replaceChild(a,b)}function Wb(a){return fa(a)&&1==a.nodeType}function Xb(a){if(xb)return a.parentElement;a=a.parentNode;return Wb(a)?a:l}
function Yb(a,b){if(a.contains&&1==b.nodeType)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a}function Lb(a){return 9==a.nodeType?a:a.ownerDocument||a.document}function Tb(a){if(a&&"number"==typeof a.length){if(fa(a))return"function"==typeof a.item||"string"==typeof a.item;if(u(a))return"function"==typeof a.item}return m}function Kb(a){this.Aa=a||q.document||document}o=Kb.prototype;
o.createElement=function(a){return this.Aa.createElement(a)};o.createTextNode=function(a){return this.Aa.createTextNode(a)};o.appendChild=function(a,b){a.appendChild(b)};o.append=function(a,b){Sb(Lb(a),a,arguments,1)};o.contains=Yb;!D||ub(9);var Zb=!D||ub(9),$b=D&&!J("8");!I||J("528");E&&J("1.9b")||D&&J("8")||gb&&J("9.5")||I&&J("528");!E||J("8");function ac(){}ac.prototype.Eb=m;ac.prototype.Ha=function(){this.Eb||(this.Eb=k,this.Ia())};ac.prototype.Ia=function(){this.$b&&bc.apply(l,this.$b)};function bc(a){for(var b=0,c=arguments.length;b<c;++b){var d=arguments[b];ea(d)?bc.apply(l,d):d&&"function"==typeof d.Ha&&d.Ha()}};function K(a,b){this.type=a;this.currentTarget=this.target=b}ma(K,ac);K.prototype.Ia=function(){delete this.type;delete this.target;delete this.currentTarget};K.prototype.qb=m;K.prototype.Qb=k;K.prototype.preventDefault=function(){this.Qb=m};function cc(a){cc[" "](a);return a}cc[" "]=n();function dc(a,b){a&&this.init(a,b)}ma(dc,K);o=dc.prototype;o.target=l;o.relatedTarget=l;o.offsetX=0;o.offsetY=0;o.clientX=0;o.clientY=0;o.screenX=0;o.screenY=0;o.button=0;o.keyCode=0;o.charCode=0;o.ctrlKey=m;o.altKey=m;o.shiftKey=m;o.metaKey=m;o.H=l;
o.init=function(a,b){var c=this.type=a.type;K.call(this,c);this.target=a.target||a.srcElement;this.currentTarget=b;var d=a.relatedTarget;if(d){if(E){var f;a:{try{cc(d.nodeName);f=k;break a}catch(e){}f=m}f||(d=l)}}else"mouseover"==c?d=a.fromElement:"mouseout"==c&&(d=a.toElement);this.relatedTarget=d;this.offsetX=I||a.offsetX!==h?a.offsetX:a.layerX;this.offsetY=I||a.offsetY!==h?a.offsetY:a.layerY;this.clientX=a.clientX!==h?a.clientX:a.pageX;this.clientY=a.clientY!==h?a.clientY:a.pageY;this.screenX=
a.screenX||0;this.screenY=a.screenY||0;this.button=a.button;this.keyCode=a.keyCode||0;this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.state=a.state;this.H=a;delete this.Qb;delete this.qb};o.preventDefault=function(){dc.Sb.preventDefault.call(this);var a=this.H;if(a.preventDefault)a.preventDefault();else if(a.returnValue=m,$b)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};
o.ac=aa("H");o.Ia=function(){dc.Sb.Ia.call(this);this.relatedTarget=this.currentTarget=this.target=this.H=l};function ec(){}var fc=0;o=ec.prototype;o.key=0;o.la=m;o.Cb=m;o.init=function(a,b,c,d,f,e){if(u(a))this.Kb=k;else if(a&&a.handleEvent&&u(a.handleEvent))this.Kb=m;else throw Error("Invalid listener argument");this.La=a;this.Ob=b;this.src=c;this.type=d;this.capture=!!f;this.Ka=e;this.Cb=m;this.key=++fc;this.la=m};o.handleEvent=function(a){return this.Kb?this.La.call(this.Ka||this.src,a):this.La.handleEvent.call(this.La,a)};var gc={},L={},hc={},ic={};
function N(a,b,c,d,f){if(b){if(da(b)){for(var e=0;e<b.length;e++)N(a,b[e],c,d,f);return l}var d=!!d,g=L;b in g||(g[b]={l:0,$:0});g=g[b];d in g||(g[d]={l:0,$:0},g.l++);var g=g[d],j=a[ga]||(a[ga]=++ha),i;g.$++;if(g[j]){i=g[j];for(e=0;e<i.length;e++)if(g=i[e],g.La==c&&g.Ka==f){if(g.la)break;return i[e].key}}else i=g[j]=[],g.l++;e=jc();e.src=a;g=new ec;g.init(c,e,a,b,d,f);c=g.key;e.key=c;i.push(g);gc[c]=g;hc[j]||(hc[j]=[]);hc[j].push(g);a.addEventListener?(a==q||!a.Zb)&&a.addEventListener(b,e,d):a.attachEvent(b in
ic?ic[b]:ic[b]="on"+b,e);return c}throw Error("Invalid event type");}function jc(){var a=kc,b=Zb?function(c){return a.call(b.src,b.key,c)}:function(c){c=a.call(b.src,b.key,c);if(!c)return c};return b}
function lc(a){if(gc[a]){var b=gc[a];if(!b.la){var c=b.src,d=b.type,f=b.Ob,e=b.capture;c.removeEventListener?(c==q||!c.Zb)&&c.removeEventListener(d,f,e):c.detachEvent&&c.detachEvent(d in ic?ic[d]:ic[d]="on"+d,f);c=c[ga]||(c[ga]=++ha);f=L[d][e][c];if(hc[c]){var g=hc[c];C(g,b);0==g.length&&delete hc[c]}b.la=k;f.Mb=k;mc(d,e,c,f);delete gc[a]}}}
function mc(a,b,c,d){if(!d.Ma&&d.Mb){for(var f=0,e=0;f<d.length;f++)d[f].la?d[f].Ob.src=l:(f!=e&&(d[e]=d[f]),e++);d.length=e;d.Mb=m;0==e&&(delete L[a][b][c],L[a][b].l--,0==L[a][b].l&&(delete L[a][b],L[a].l--),0==L[a].l&&delete L[a])}}function nc(a,b,c,d,f){var e=1,b=b[ga]||(b[ga]=++ha);if(a[b]){a.$--;a=a[b];a.Ma?a.Ma++:a.Ma=1;try{for(var g=a.length,j=0;j<g;j++){var i=a[j];i&&!i.la&&(e&=oc(i,f)!==m)}}finally{a.Ma--,mc(c,d,b,a)}}return Boolean(e)}
function oc(a,b){var c=a.handleEvent(b);a.Cb&&lc(a.key);return c}
function kc(a,b){if(!gc[a])return k;var c=gc[a],d=c.type,f=L;if(!(d in f))return k;var f=f[d],e,g;if(!Zb){var j;if(!(j=b))a:{j=["window","event"];for(var i=q;e=j.shift();)if(i[e]!=l)i=i[e];else{j=l;break a}j=i}e=j;j=k in f;i=m in f;if(j){if(0>e.keyCode||e.returnValue!=h)return k;a:{var p=m;if(0==e.keyCode)try{e.keyCode=-1;break a}catch(A){p=k}if(p||e.returnValue==h)e.returnValue=k}}p=new dc;p.init(e,this);e=k;try{if(j){for(var r=[],M=p.currentTarget;M;M=M.parentNode)r.push(M);g=f[k];g.$=g.l;for(var F=
r.length-1;!p.qb&&0<=F&&g.$;F--)p.currentTarget=r[F],e&=nc(g,r[F],d,k,p);if(i){g=f[m];g.$=g.l;for(F=0;!p.qb&&F<r.length&&g.$;F++)p.currentTarget=r[F],e&=nc(g,r[F],d,m,p)}}else e=oc(c,p)}finally{r&&(r.length=0),p.Ha()}return e}d=new dc(b,this);try{e=oc(c,d)}finally{d.Ha()}return e};function pc(a,b){this.J={};this.n=[];var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a){var f;if(a instanceof pc)qc(a),f=a.n.concat(),d=O(a);else{var c=[],e=0;for(f in a)c[e++]=f;f=c;c=[];e=0;for(d in a)c[e++]=a[d];d=c}for(c=0;c<f.length;c++)this.set(f[c],d[c])}}o=pc.prototype;o.l=0;function O(a){qc(a);for(var b=[],c=0;c<a.n.length;c++)b.push(a.J[a.n[c]]);return b}
o.clear=function(){this.J={};this.l=this.n.length=0};o.remove=function(a){return rc(this.J,a)?(delete this.J[a],this.l--,this.n.length>2*this.l&&qc(this),k):m};function qc(a){if(a.l!=a.n.length){for(var b=0,c=0;b<a.n.length;){var d=a.n[b];rc(a.J,d)&&(a.n[c++]=d);b++}a.n.length=c}if(a.l!=a.n.length){for(var f={},c=b=0;b<a.n.length;)d=a.n[b],rc(f,d)||(a.n[c++]=d,f[d]=1),b++;a.n.length=c}}o.get=function(a,b){return rc(this.J,a)?this.J[a]:b};
o.set=function(a,b){rc(this.J,a)||(this.l++,this.n.push(a));this.J[a]=b};function rc(a,b){return Object.prototype.hasOwnProperty.call(a,b)};function sc(){}function tc(a,b){a.g=new pc;a.tb=[];a.ua=[];a.ra=[];a.ca=[];a.Ua=[];a.Ca={ia:m,ha:m};a.Da=new pc;a.Bb=b}function uc(a,b){var c=a.hc(b);c||(c={ia:m,ha:m},c.set(b,c));return c}
function vc(a,b){var c=a.Nb(b),d=a.lb(b),f=[],e=[];v(a.tb,function(a){c.h(a.type,a.Ka)});v(a.ua,function(a){if(a.onInitAnnotator)a.onInitAnnotator(c)});v(a.ca,function(a){a.src==d&&(c.t(a),f.push(a))});v(a.Ua,function(a){a.src==d&&(c.r(a),e.push(a))});v(f,function(b){C(a.ca,b)});v(e,function(b){C(a.Ua,b)});var g=a.Da.get(d);g?(g.ia&&c.I(),g.ha&&c.O(),a.Da.remove(d)):(a.Ca.ia&&c.I(),a.Ca.ha&&c.O());a.g.set(d,c);C(a.ra,b)}
function wc(a){v(a.ra,function(b){for(var c=b,d=c.offsetTop,f=c.offsetLeft,e=c.offsetWidth,g=c.offsetHeight;c.offsetParent;)c=c.offsetParent,d+=c.offsetTop,f+=c.offsetLeft;d<window.pageYOffset+window.innerHeight&&f<window.pageXOffset+window.innerWidth&&d+g>window.pageYOffset&&f+e>window.pageXOffset&&vc(a,b)})}function xc(a,b,c){if(b){var d=a.g.get(b);d?c?d.na():d.O():uc(a,b).ha=c}else v(O(a.g),function(a){c?a.K():a.O()}),a.Ca.ha=c,v(O(a.Da),function(a){a.ha=c})}
function yc(a,b,c){if(b){var d=a.g.get(b);d?c?d.K():d.I():uc(a,b).ia=c}else v(O(a.g),function(a){c?a.K():a.I()}),a.Ca.ia=c,v(O(a.Da),function(a){a.ia=c})}o=sc.prototype;o.S=function(a,b){var c=h,d=h;t(a)?(c=a,d=b):u(a)&&(d=a);c?(c=this.g.get(c))&&c.S(d):v(O(this.g),function(a){a.S(d)})};o.t=function(a,b){if(P(this,a.src)){var c=this.g.get(a.src);c?c.t(a,b):(this.ca.push(a),b&&C(this.ca,b))}};o.h=function(a,b){v(O(this.g),function(c){c.h(a,b)});this.tb.push({type:a,Ka:b})};
o.hb=function(a){this.ua.push(a);v(O(this.g),function(b){if(a.onInitAnnotator)a.onInitAnnotator(b)})};o.ga=function(a,b){if(P(this,a)){var c=this.g.get(a);c&&c.ga(b)}};function P(a,b){return rc(a.g.J,b)?k:B(a.ra,function(c){return a.lb(c)==b})!=l}o.X=function(a){if(P(this,a)&&(a=this.g.get(a)))return a.X().getName()};o.D=function(a){if(a){var b=this.g.get(a);return b?b.D():Pa(this.ca,function(b){return b.src==a})}var c=[];v(O(this.g),function(a){Ta(c,a.D())});Ta(c,this.ca);return c};
o.Y=function(a){if(P(this,a)&&(a=this.g.get(a)))return Qa(a.Y(),function(a){return a.getName()})};o.O=function(a){xc(this,a,m)};o.I=function(a){yc(this,a,m)};o.m=function(a){if(a){if(P(this,a.src)){var b=this.g.get(a.src);b&&b.m(a)}}else v(O(this.g),function(a){a.m()})};o.init=function(){this.Bb&&Ta(this.ra,this.Bb());wc(this);var a=this,b=N(window,"scroll",function(){0<a.ra.length?wc(a):lc(b)})};o.nb=function(a){this.rb(a)&&vc(this,a)};
o.r=function(a){if(P(this,a.src)){var b=this.g.get(a.src);b?b.r(a):this.Ua.push(a)}};o.ma=function(a,b){if(P(this,a)){var c=this.g.get(a);c&&c.ma(b)}};o.na=function(a){xc(this,a,k)};o.K=function(a){yc(this,a,k)};function Q(a,b){var c=Jb().createElement("DIV");c.innerHTML=a(b||zc,h,h);if(1==c.childNodes.length){var d=c.firstChild;if(1==d.nodeType)return d}return c}var zc={};function Ac(){return k};/*
 Portions of this code are from the Dojo Toolkit, received by
 The Closure Library Authors under the BSD license. All other code is
 Copyright 2005-2009 The Closure Library Authors. All Rights Reserved.

 The "New" BSD License:

 Copyright (c) 2005-2009, The Dojo Foundation
 All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

 Redistributions of source code must retain the above copyright notice, this
 list of conditions and the following disclaimer.
 Redistributions in binary form must reproduce the above copyright notice,
 this list of conditions and the following disclaimer in the documentation
 and/or other materials provided with the distribution.
 Neither the name of the Dojo Foundation nor the names of its contributors
 may be used to endorse or promote products derived from this software
 without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
 FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
var R=function(){function a(a,c){if(!a)return[];if(a.constructor==Array)return a;if(!t(a))return[a];if(t(c)&&(c=t(c)?document.getElementById(c):c,!c))return[];var c=c||document,e=c.ownerDocument||c.documentElement;ua=c.contentType&&"application/xml"==c.contentType||gb&&(c.doctype||"[object XMLDocument]"==e.toString())||!!e&&(D?e.xml:c.xmlVersion||e.xmlVersion);return(e=d(a)(c))&&e.Pa?e:b(e)}function b(a){if(a&&a.Pa)return a;var b=[];if(!a||!a.length)return b;a[0]&&b.push(a[0]);if(2>a.length)return b;
U++;if(D&&ua){var c=U+"";a[0].setAttribute("_zipIdx",c);for(var d=1,e;e=a[d];d++)a[d].getAttribute("_zipIdx")!=c&&b.push(e),e.setAttribute("_zipIdx",c)}else if(D&&a.Yb)try{for(d=1;e=a[d];d++)hb(e)&&b.push(e)}catch(f){}else{a[0]&&(a[0]._zipIdx=U);for(d=1;e=a[d];d++)a[d]._zipIdx!=U&&b.push(e),e._zipIdx=U}return b}function c(a,b){if(!b)return 1;var c=Pd(a);return!b[c]?b[c]=1:0}function d(a,b){if(Kc){var c=Lc[a];if(c&&!b)return c}if(c=Mc[a])return c;var c=a.charAt(0),e=-1==a.indexOf(" ");0<=a.indexOf("#")&&
e&&(b=k);if(Kc&&!b&&-1==">~+".indexOf(c)&&(!D||-1==a.indexOf(":"))&&!(Nc&&0<=a.indexOf("."))&&-1==a.indexOf(":contains")&&-1==a.indexOf("|=")){var g=0<=">~+".indexOf(a.charAt(a.length-1))?a+" *":a;return Lc[a]=function(b){try{if(!(9==b.nodeType||e))throw"";var c=b.querySelectorAll(g);D?c.Yb=k:c.Pa=k;return c}catch(f){return d(a,k)(b)}}}var i=a.split(/\s*,\s*/);return Mc[a]=2>i.length?f(a):function(a){for(var b=0,c=[],d;d=i[b++];)c=c.concat(f(d)(a));return c}}function f(a){var b=Oc(Ca(a));if(1==b.length){var c=
e(b[0]);return function(a){if(a=c(a,[]))a.Pa=k;return a}}return function(a){for(var a=Ja(a),c,d,f=b.length,g,ta,Ob=0;Ob<f;Ob++){ta=[];c=b[Ob];d=a.length-1;0<d&&(g={},ta.Pa=k);d=e(c);for(var i=0;c=a[i];i++)d(c,ta,g);if(!ta.length)break;a=ta}return ta}}function e(a){var b=Pc[a.ja];if(b)return b;var c=a.Ib,c=c?c.Qa:"",d=p(a,{v:1}),e="*"==a.w,f=document.getElementsByClassName;if(c)f={v:1},e&&(f.w=1),d=p(a,f),"+"==c?b=i(d):"~"==c?b=j(d):">"==c&&(b=g(d));else if(a.id)d=!a.Lb&&e?Ac:p(a,{v:1,id:1}),b=function(b,
c){var e;e=Jb(b);var f=a.id;if(f=(e=t(f)?e.Aa.getElementById(f):f)&&d(e))if(!(f=9==b.nodeType)){for(f=e.parentNode;f&&!(f==b);)f=f.parentNode;f=!!f}if(f)return Ja(e,c)};else if(f&&/\{\s*\[native code\]\s*\}/.test(""+f)&&a.N.length&&!Nc)var d=p(a,{v:1,N:1,id:1}),r=a.N.join(" "),b=function(a,b){for(var c=Ja(0,b),e,f=0,g=a.getElementsByClassName(r);e=g[f++];)d(e,a)&&c.push(e);return c};else!e&&!a.Lb?b=function(b,c){for(var d=Ja(0,c),e,f=0,g=b.getElementsByTagName(a.mb());e=g[f++];)d.push(e);return d}:
(d=p(a,{v:1,w:1,id:1}),b=function(b,c){for(var e=Ja(0,c),f,g=0,Od=b.getElementsByTagName(a.mb());f=Od[g++];)d(f,b)&&e.push(f);return e});return Pc[a.ja]=b}function g(a){a=a||Ac;return function(b,d,e){for(var f=0,g=b[Qc];b=g[f++];)Ka(b)&&(!e||c(b,e))&&a(b,f)&&d.push(b);return d}}function j(a){return function(b,d,e){for(b=b[La];b;){if(Ka(b)){if(e&&!c(b,e))break;a(b)&&d.push(b)}b=b[La]}return d}}function i(a){return function(b,d,e){for(;b=b[La];)if(!ib||hb(b)){(!e||c(b,e))&&a(b)&&d.push(b);break}return d}}
function p(a,b){if(!a)return Ac;var b=b||{},c=l;b.v||(c=va(c,hb));b.w||"*"!=a.w&&(c=va(c,function(b){return b&&b.tagName==a.mb()}));b.N||v(a.N,function(a,b){var d=RegExp("(?:^|\\s)"+a+"(?:\\s|$)");c=va(c,function(a){return d.test(a.className)});c.count=b});b.Z||v(a.Z,function(a){var b=a.name;Pb[b]&&(c=va(c,Pb[b](b,a.value)))});b.Ga||v(a.Ga,function(a){var b,d=a.ib;a.type&&Rc[a.type]?b=Rc[a.type](d,a.ob):d.length&&(b=Qd(d));b&&(c=va(c,b))});b.id||a.id&&(c=va(c,function(b){return!!b&&b.id==a.id}));
c||"default"in b||(c=Ac);return c}function A(a){return M(a)%2}function r(a){return!(M(a)%2)}function M(a){var b=a.parentNode,c=0,d=b[Qc],e=a._i||-1,f=b._l||-1;if(!d)return-1;d=d.length;if(f==d&&0<=e&&0<=f)return e;b._l=d;e=-1;for(b=b.firstElementChild||b.firstChild;b;b=b[La])Ka(b)&&(b._i=++c,a===b&&(e=c));return e}function F(a){for(;a=a[La];)if(Ka(a))return m;return k}function Sc(a){for(;a=a[Rd];)if(Ka(a))return m;return k}function wa(a,b){return!a?"":"class"==b?a.className||"":"for"==b?a.htmlFor||
"":"style"==b?a.style.cssText||"":(ua?a.getAttribute(b):a.getAttribute(b,2))||""}function hb(a){return 1==a.nodeType}function va(a,b){return!a?b:!b?a:function(){return a.apply(window,arguments)&&b.apply(window,arguments)}}function Oc(a){function b(){0<=p&&(s.id=c(p,z).replace(/\\/g,""),p=-1);if(0<=r){var a=r==z?l:c(r,z);0>">~+".indexOf(a)?s.w=a:s.Qa=a;r=-1}0<=j&&(s.N.push(c(j+1,z).replace(/\\/g,"")),j=-1)}function c(b,d){return Ca(a.slice(b,d))}for(var a=0<=">~+".indexOf(a.slice(-1))?a+" * ":a+" ",
d=[],e=-1,f=-1,g=-1,i=-1,j=-1,p=-1,r=-1,A="",G="",F,z=0,M=a.length,s=l,H=l;A=G,G=a.charAt(z),z<M;z++)if("\\"!=A)if(s||(F=z,s={ja:l,Z:[],Ga:[],N:[],w:l,Qa:l,id:l,mb:function(){return ua?this.cc:this.w}},r=z),0<=e)if("]"==G){H.ib?H.ob=c(g||e+1,z):H.ib=c(e+1,z);if((e=H.ob)&&('"'==e.charAt(0)||"'"==e.charAt(0)))H.ob=e.slice(1,-1);s.Ga.push(H);H=l;e=g=-1}else"="==G&&(g=0<="|~^$*".indexOf(A)?A:"",H.type=g+G,H.ib=c(e+1,z-g.length),g=z+1);else 0<=f?")"==G&&(0<=i&&(H.value=c(f+1,z)),i=f=-1):"#"==G?(b(),p=
z+1):"."==G?(b(),j=z):":"==G?(b(),i=z):"["==G?(b(),e=z,H={}):"("==G?(0<=i&&(H={name:c(i+1,z),value:l},s.Z.push(H)),f=z):" "==G&&A!=G&&(b(),0<=i&&s.Z.push({name:c(i+1,z)}),s.Lb=s.Z.length||s.Ga.length||s.N.length,s.oc=s.ja=c(F,z),s.cc=s.w=s.Qa?l:s.w||"*",s.w&&(s.w=s.w.toUpperCase()),d.length&&d[d.length-1].Qa&&(s.Ib=d.pop(),s.ja=s.Ib.ja+" "+s.ja),d.push(s),s=l);return d}function Ja(a,b){var c=b||[];a&&c.push(a);return c}var Nc=I&&"BackCompat"==document.compatMode,Qc=document.firstChild.children?"children":
"childNodes",ua=m,Rc={"*=":function(a,b){return function(c){return 0<=wa(c,a).indexOf(b)}},"^=":function(a,b){return function(c){return 0==wa(c,a).indexOf(b)}},"$=":function(a,b){return function(c){c=" "+wa(c,a);return c.lastIndexOf(b)==c.length-b.length}},"~=":function(a,b){var c=" "+b+" ";return function(b){return 0<=(" "+wa(b,a)+" ").indexOf(c)}},"|=":function(a,b){b=" "+b;return function(c){c=" "+wa(c,a);return c==b||0==c.indexOf(b+"-")}},"=":function(a,b){return function(c){return wa(c,a)==b}}},
ib="undefined"==typeof document.firstChild.nextElementSibling,La=!ib?"nextElementSibling":"nextSibling",Rd=!ib?"previousElementSibling":"previousSibling",Ka=ib?hb:Ac,Pb={checked:function(){return function(a){return a.checked||a.attributes.checked}},"first-child":function(){return Sc},"last-child":function(){return F},"only-child":function(){return function(a){return!Sc(a)||!F(a)?m:k}},empty:function(){return function(a){for(var b=a.childNodes,a=a.childNodes.length-1;0<=a;a--){var c=b[a].nodeType;
if(1===c||3==c)return m}return k}},contains:function(a,b){var c=b.charAt(0);if('"'==c||"'"==c)b=b.slice(1,-1);return function(a){return 0<=a.innerHTML.indexOf(b)}},not:function(a,b){var c=Oc(b)[0],d={v:1};"*"!=c.w&&(d.w=1);c.N.length||(d.N=1);var e=p(c,d);return function(a){return!e(a)}},"nth-child":function(a,b){if("odd"==b)return A;if("even"==b)return r;if(-1!=b.indexOf("n")){var c=b.split("n",2),d=c[0]?"-"==c[0]?-1:parseInt(c[0],10):1,e=c[1]?parseInt(c[1],10):0,f=0,g=-1;0<d?0>e?e=e%d&&d+e%d:0<
e&&(e>=d&&(f=e-e%d),e%=d):0>d&&(d*=-1,0<e&&(g=e,e%=d));if(0<d)return function(a){a=M(a);return a>=f&&(0>g||a<=g)&&a%d==e};b=e}var i=parseInt(b,10);return function(a){return M(a)==i}}},Qd=D?function(a){var b=a.toLowerCase();"class"==b&&(a="className");return function(c){return ua?c.getAttribute(a):c[a]||c[b]}}:function(a){return function(b){return b&&b.getAttribute&&b.hasAttribute(a)}},Pc={},Mc={},Lc={},Kc=!!document.querySelectorAll&&(!I||J("526")),U=0,Pd=D?function(a){return ua?a.getAttribute("_uid")||
a.setAttribute("_uid",++U)||U:a.uniqueID}:function(a){return a._uid||(a._uid=++U)};a.Z=Pb;return a}();ba("goog.dom.query",R);ba("goog.dom.query.pseudos",R.Z);function Bc(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d}Bc.prototype.contains=function(a){return!this||!a?m:a instanceof Bc?a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom:a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom};function Cc(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d}Cc.prototype.contains=function(a){return a instanceof Cc?this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height:a.x>=this.left&&a.x<=this.left+this.width&&a.y>=this.top&&a.y<=this.top+this.height};function S(a,b,c){t(b)?Dc(a,c,b):Gb(b,la(Dc,a))}function Dc(a,b,c){a.style[Na(c)]=b}function T(a,b){var c=Lb(a);return c.defaultView&&c.defaultView.getComputedStyle&&(c=c.defaultView.getComputedStyle(a,l))?c[b]||c.getPropertyValue(b):""}function Ec(a,b){return a.currentStyle?a.currentStyle[b]:l}function Fc(a,b){return T(a,b)||Ec(a,b)||a.style&&a.style[b]}function Gc(a,b,c){var d,f=E&&(bb||kb)&&J("1.9");b instanceof Eb?(d=b.x,b=b.y):(d=b,b=c);a.style.left=Hc(d,f);a.style.top=Hc(b,f)}
function Ic(a){var b=a.getBoundingClientRect();D&&(a=a.ownerDocument,b.left-=a.documentElement.clientLeft+a.body.clientLeft,b.top-=a.documentElement.clientTop+a.body.clientTop);return b}
function Jc(a){if(D&&!ub(8))return a.offsetParent;for(var b=Lb(a),c=Fc(a,"position"),d="fixed"==c||"absolute"==c,a=a.parentNode;a&&a!=b;a=a.parentNode)if(c=Fc(a,"position"),d=d&&"static"==c&&a!=b.documentElement&&a!=b.body,!d&&(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight||"fixed"==c||"absolute"==c||"relative"==c))return a;return l}
function Tc(a){var b,c=Lb(a),d=Fc(a,"position"),f=E&&c.getBoxObjectFor&&!a.getBoundingClientRect&&"absolute"==d&&(b=c.getBoxObjectFor(a))&&(0>b.screenX||0>b.screenY),e=new Eb(0,0),g;b=c?9==c.nodeType?c:Lb(c):document;if(g=D)if(g=!ub(9))Jb(b),g=m;g=g?b.body:b.documentElement;if(a==g)return e;if(a.getBoundingClientRect)b=Ic(a),a=Jb(c),a=Qb(a.Aa),e.x=b.left+a.x,e.y=b.top+a.y;else if(c.getBoxObjectFor&&!f)b=c.getBoxObjectFor(a),a=c.getBoxObjectFor(g),e.x=b.screenX-a.screenX,e.y=b.screenY-a.screenY;else{b=
a;do{e.x+=b.offsetLeft;e.y+=b.offsetTop;b!=a&&(e.x+=b.clientLeft||0,e.y+=b.clientTop||0);if(I&&"fixed"==Fc(b,"position")){e.x+=c.body.scrollLeft;e.y+=c.body.scrollTop;break}b=b.offsetParent}while(b&&b!=a);if(gb||I&&"absolute"==d)e.y-=c.body.offsetTop;for(b=a;(b=Jc(b))&&b!=c.body&&b!=g;)if(e.x-=b.scrollLeft,!gb||"TR"!=b.tagName)e.y-=b.scrollTop}return e}function Uc(a,b){var c=Vc(a),d=Vc(b);return new Eb(c.x-d.x,c.y-d.y)}
function Vc(a){var b=new Eb;if(1==a.nodeType)if(a.getBoundingClientRect)a=Ic(a),b.x=a.left,b.y=a.top;else{var c;c=Jb(a);c=Qb(c.Aa);a=Tc(a);b.x=a.x-c.x;b.y=a.y-c.y}else{c=u(a.ac);var d=a;a.targetTouches?d=a.targetTouches[0]:c&&a.H.targetTouches&&(d=a.H.targetTouches[0]);b.x=d.clientX;b.y=d.clientY}return b}function Wc(a,b,c){if(b instanceof Fb)c=b.height,b=b.width;else if(c==h)throw Error("missing height argument");a.style.width=Hc(b,k);a.style.height=Hc(c,k)}
function Hc(a,b){"number"==typeof a&&(a=(b?Math.round(a):a)+"px");return a}function Xc(a){if("none"!=Fc(a,"display"))return Yc(a);var b=a.style,c=b.display,d=b.visibility,f=b.position;b.visibility="hidden";b.position="absolute";b.display="inline";a=Yc(a);b.display=c;b.position=f;b.visibility=d;return a}function Yc(a){var b=a.offsetWidth,c=a.offsetHeight,d=I&&!b&&!c;return(b===h||d)&&a.getBoundingClientRect?(a=Ic(a),new Fb(a.right-a.left,a.bottom-a.top)):new Fb(b,c)}
function Zc(a){var b=Tc(a),a=Xc(a);return new Cc(b.x,b.y,a.width,a.height)}function V(a,b){var c=a.style;"opacity"in c?c.opacity=b:"MozOpacity"in c?c.MozOpacity=b:"filter"in c&&(c.filter=""===b?"":"alpha(opacity="+100*b+")")}function W(a,b){a.style.display=b?"":"none"}function $c(a,b){if(/^\d+px?$/.test(b))return parseInt(b,10);var c=a.style.left,d=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=b;var f=a.style.pixelLeft;a.style.left=c;a.runtimeStyle.left=d;return f}
function ad(a,b){if(D){var c=$c(a,Ec(a,b+"Left")),d=$c(a,Ec(a,b+"Right")),f=$c(a,Ec(a,b+"Top")),e=$c(a,Ec(a,b+"Bottom"));return new Bc(f,d,e,c)}c=T(a,b+"Left");d=T(a,b+"Right");f=T(a,b+"Top");e=T(a,b+"Bottom");return new Bc(parseFloat(f),parseFloat(d),parseFloat(e),parseFloat(c))};function bd(a,b){this.U=a;this.o=new cd;this.ya=[];this.fb=k;var c=Zc(a);this.element=Rb("div","annotorious-annotationlayer");S(this.element,"position","relative");S(this.element,"display","inline-block");dd(a,this.element);Wc(this.element,c.width,c.height);Vb(this.element,a);this.element.appendChild(a);this.R=Q(ed,{width:c.width,height:c.height});zb(this.R,"annotorious-item-unfocus");this.element.appendChild(this.R);this.e=Q(ed,{width:c.width,height:c.height});W(this.e,m);this.element.appendChild(this.e);
this.popup=b?b:new X(this);c=new fd;c.init(this.e,this);this.ya.push(c);this.da=c;this.editor=new gd(this);this.k=new hd(this.R,this.popup,this);this.ub=new id(this,this.element);var d=this;N(this.element,"mouseover",function(a){a=a.relatedTarget;if(!a||!Yb(d.element,a))d.o.fireEvent(jd),Db(d.R,"annotorious-item-unfocus","annotorious-item-focus")});N(this.element,"mouseout",function(a){a=a.relatedTarget;if(!a||!Yb(d.element,a))d.o.fireEvent(kd),Db(d.R,"annotorious-item-focus","annotorious-item-unfocus")});
N(this.R,"mousedown",function(a){d.fb&&(W(d.e,k),d.k.m(h),d.da.startSelection(a.offsetX,a.offsetY))});this.o.h(ld,function(a){a=a.viewportBounds;d.editor.aa({x:a.left+d.U.offsetLeft,y:a.bottom+4+d.U.offsetTop});d.editor.open()});this.o.h(md,function(){W(d.e,m);d.da.stopSelection()})}
function dd(a,b){function c(c,d){S(b,"margin-"+c,d+"px");S(a,"margin-"+c,0);S(a,"padding-"+c,0)}var d=ad(a,"margin"),f=ad(a,"padding");(0!=d.top||0!=f.top)&&c("top",d.top+f.top);(0!=d.right||0!=f.right)&&c("right",d.right+f.right);(0!=d.bottom||0!=f.bottom)&&c("bottom",d.bottom+f.bottom);(0!=d.left||0!=f.left)&&c("left",d.left+f.left)}o=bd.prototype;o.S=n();o.t=function(a,b){this.k.t(a,b)};o.h=function(a,b){this.o.h(a,b)};o.ga=function(a){a.init(this,this.e);this.ya.push(a)};
o.Fb=function(a){this.k.r(a);var b=B(this.ya,function(b){return b.getSupportedShapeType()==a.shapes[0].type});if(b){W(this.e,k);this.k.m(h);var c=this.e.getContext("2d"),d=a.shapes[0],f=this,d="pixel"==d.units?d:Aa(d,function(a){return f.Ba(a)});b.drawShape(c,d)}b=ya(a.shapes[0]).geometry;b="pixel"==a.shapes[0].units?{x:b.x,y:b.y+b.height}:this.Ba({x:b.x,y:b.y+b.height});this.editor.aa({x:b.x+this.U.offsetLeft,y:b.y+4+this.U.offsetTop});this.editor.open(a)};
o.fireEvent=function(a,b){return this.o.fireEvent(a,b)};o.Ba=function(a){var b=Xc(this.U);return{x:a.x*b.width,y:a.y*b.height}};o.X=aa("da");o.D=function(){return this.k.D()};o.Ja=function(){return Sa(this.k.Ja(x,y))};o.Y=aa("ya");o.getItem=function(){return{src:nd(this.U)}};function nd(a){var b=a.getAttribute("data-original");return b?b:a.src}o.O=function(){W(this.R,m)};
o.I=function(){this.fb=m;var a=this.ub;a.Xa();delete a.yb;delete a.xb;delete a.eb;delete a.cb;(a=a.element)&&a.parentNode&&a.parentNode.removeChild(a);delete this.ub};o.m=function(a){this.k.m(a)};o.r=function(a){this.k.r(a)};o.ka=function(a,b){this.o.ka(a,b)};o.ma=function(a){(this.da=B(this.ya,function(b){return b.getName()==a}))||console.log('WARNING: selector "'+a+'" not available')};o.na=function(){W(this.R,k)};o.K=function(){this.fb=k};
o.stopSelection=function(a){W(this.e,m);this.da.stopSelection();a&&this.k.t(a)};o.Ra=function(a){var b=Xc(this.U);return{x:a.x/b.width,y:a.y/b.height}};bd.prototype.fireEvent=bd.prototype.fireEvent;bd.prototype.toItemCoordinates=bd.prototype.Ra;function od(){tc(this,function(){return R("img.annotatable",document)})}ma(od,sc);od.prototype.lb=function(a){return nd(a)};od.prototype.Nb=function(a){return new bd(a)};od.prototype.rb=function(a){return Wb(a)?"IMG"==a.tagName:m};function hd(a,b,c){this.L=a;this.j=b;this.d=c;this.ba=[];this.V=[];this.z=this.L.getContext("2d");this.fa=k;this.$a=m;var d=this;N(this.L,"mousemove",function(a){if(d.fa){var b=pd(d,a.offsetX,a.offsetY);b?(d.$a=m,d.c?d.c!=b&&(d.fa=m,qd(d.j)):(d.c=b,rd(d),d.d.fireEvent(sd,{W:d.c,mouseEvent:a}))):!d.$a&&d.c&&(d.fa=m,qd(d.j))}else d.oa=a});c.h(kd,function(){delete d.c;d.fa=k});c.h(td,function(){if(!d.fa&&d.oa){var a=d.c;d.c=pd(d,d.oa.offsetX,d.oa.offsetY);d.fa=k;a!=d.c?(rd(d),d.d.fireEvent(ud,{W:a,mouseEvent:d.oa}),
d.d.fireEvent(sd,{W:d.c,mouseEvent:d.oa})):d.c&&vd(d.j)}else rd(d)})}o=hd.prototype;o.t=function(a,b){b&&(b==this.c&&delete this.c,C(this.ba,b),delete this.V[Ba(b.shapes[0])]);this.ba.push(a);var c=a.shapes[0];if("pixel"!=c.units)var d=this,c=Aa(c,function(a){return d.d.Ba(a)});this.V[Ba(a.shapes[0])]=c;rd(this)};o.r=function(a){a==this.c&&delete this.c;C(this.ba,a);delete this.V[Ba(a.shapes[0])];rd(this)};o.D=function(){return Sa(this.ba)};o.m=function(a){(this.c=a)?this.$a=k:qd(this.j);rd(this)};
function pd(a,b,c){a=a.Ja(b,c);if(0<a.length)return a[0]}
o.Ja=function(a,b){var c=[],d=this;v(this.ba,function(f){var e;e=d.V[Ba(f.shapes[0])];if("rect"==e.type)e=a<e.geometry.x||b<e.geometry.y||a>e.geometry.x+e.geometry.width||b>e.geometry.y+e.geometry.height?m:k;else if("polygon"==e.type){e=e.geometry.points;for(var g=m,j=e.length-1,i=0;i<e.length;i++)e[i].y>b!=e[j].y>b&&a<(e[j].x-e[i].x)*(b-e[i].y)/(e[j].y-e[i].y)+e[i].x&&(g=!g),j=i;e=g}else e=m;e&&c.push(f)});Wa(c,function(a,b){return xa(a.shapes[0])>xa(b.shapes[0])});return c};
function wd(a,b,c){var d=B(a.d.Y(),function(a){return a.getSupportedShapeType()==b.type});d?d.drawShape(a.z,b,c):console.log("WARNING unsupported shape type: "+b.type)}function rd(a){a.z.clearRect(0,0,a.L.width,a.L.height);v(a.ba,function(b){wd(a,a.V[Ba(b.shapes[0])])});if(a.c){var b=a.V[Ba(a.c.shapes[0])];wd(a,b,k);b=ya(b).geometry;a.j.show(a.c,{x:b.x,y:b.y+b.height+5})}};var xd={};
function yd(a){this.Q=a;this.M=a.div;var b=parseInt(T(this.M,"width")),c=parseInt(T(this.M,"height"));this.o=new cd;this.element=Rb("div","annotorious-annotationlayer");S(this.element,"position","relative");Wc(this.element,b,c);Vb(this.element,this.M);this.element.appendChild(this.M);this.wa=Q(zd,{pb:"Click and Drag"});S(this.wa,"z-index",9998);V(this.wa,0);this.element.appendChild(this.wa);this.popup=new X(this);this.k=new Ad(a,this);this.e=Q(ed,{width:b,height:c});W(this.e,m);S(this.e,"z-index",
9999);this.element.appendChild(this.e);this.xa=new fd;this.xa.init(this.e,this);this.Fa=h;this.editor=new gd(this);S(this.editor.element,"z-index",1E4);var d=this;N(this.element,"mouseover",function(a){a=a.relatedTarget;(!a||!Yb(d.element,a))&&d.o.fireEvent(jd)});N(this.element,"mouseout",function(a){a=a.relatedTarget;(!a||!Yb(d.element,a))&&d.o.fireEvent(kd)});N(this.e,"mousedown",function(a){var b=Vc(d.M);d.xa.startSelection(a.clientX-b.x,a.clientY-b.y)});this.o.h(ld,function(a){S(d.e,"pointer-events",
"none");a=a.viewportBounds;d.editor.aa({x:a.left+d.M.offsetLeft,y:a.bottom+4+d.M.offsetTop});d.editor.open()});this.o.h(md,function(){d.stopSelection()})}o=yd.prototype;o.K=n();o.I=n();o.S=function(a){S(this.e,"pointer-events","auto");var b=this;W(this.e,k);V(this.wa,0.8);window.setTimeout(function(){V(b.wa,0)},2E3);a&&(this.Fa=a)};
o.Fb=function(a){this.k.r(a);var b=this.xa,c=this;if(b){W(this.e,k);this.k.m(h);var d=this.e.getContext("2d"),f=Aa(a.shapes[0],function(a){return c.Ba(a)});b.drawShape(d,f);b=ya(f).geometry;this.editor.aa({x:b.x+this.M.offsetLeft,y:b.y+b.height+4+this.M.offsetTop});this.editor.open(a)}};o.t=function(a){this.k.t(a)};o.h=function(a,b){this.o.h(a,b)};o.ga=n();o.fireEvent=function(a,b){return this.o.fireEvent(a,b)};
o.Ba=function(a){a=this.Q.getViewPortPxFromLonLat(new OpenLayers.LonLat(a.x,a.y));return{x:a.x,y:a.y}};o.X=aa("xa");o.D=n();o.Y=n();o.getItem=function(){return{src:"map://openlayers/something"}};o.m=function(a){this.k.m(a)};o.r=function(a){this.k.r(a)};o.ka=function(a,b){this.o.ka(a,b)};o.ma=n();o.stopSelection=function(a){W(this.e,m);this.Fa&&(this.Fa(),delete this.Fa);this.xa.stopSelection();a&&this.k.t(a)};
o.Ra=function(a){a=this.Q.getLonLatFromPixel(new OpenLayers.Pixel(a.x,a.y));return{x:a.lon,y:a.lat}};function Bd(){tc(this)}ma(Bd,sc);Bd.prototype.lb=function(){return"map://openlayers/something"};Bd.prototype.Nb=function(a){return new yd(a)};Bd.prototype.rb=function(a){return a instanceof OpenLayers.Map};function Ad(a,b){this.Q=a;this.sa=Zc(b.element);this.j=b.popup;S(this.j.element,"z-index",99E3);this.ta=[];this.Ta=new OpenLayers.Layer.Boxes("Annotorious");this.Q.addLayer(this.Ta);var c=this;this.Q.events.register("move",this.Q,function(){c.ea&&Cd(c)});b.h(td,function(){c.ab==c.ea?vd(c.j):Dd(c,c.ab,c.ea)})}
function Cd(a){var b=a.ea.Na.div,c=Zc(b),d=Uc(b,a.Q.div),b=d.y,d=d.x,f=c.width,e=c.height,c=Zc(a.j.element),b={y:b+e+5};d+c.width>a.sa.width?(Db(a.j.element,"top-left","top-right"),b.x=d+f-c.width):(Db(a.j.element,"top-right","top-left"),b.x=d);0>b.x&&(b.x=0);b.x+c.width>a.sa.width&&(b.x=a.sa.width-c.width);b.y+c.height>a.sa.height&&(b.y=a.sa.height-c.height);a.j.aa(b)}
function Dd(a,b,c){b?(Uc(b.Na.div,a.Q.div),Na("height"),S(b.Jb,"border-color","#fff000"),a.ea=b,Ed(a.j,b.W),Cd(a),a.j.show()):delete a.ea;c&&S(c.Jb,"border-color","#fff")}
Ad.prototype.t=function(a){var b=a.shapes[0].geometry,b=new OpenLayers.Marker.Box(new OpenLayers.Bounds(b.x,b.y,b.x+b.width,b.y+b.height));zb(b.div,"annotorious-ol-boxmarker-outer");S(b.div,"border",l);var c=Rb("div","annotorious-ol-boxmarker-inner");Wc(c,"100%","100%");b.div.appendChild(c);var d={W:a,Na:b,Jb:c},f=this;N(c,"mouseover",function(){f.ea||Dd(f,d);f.ab=d});N(c,"mouseout",function(){delete f.ab;qd(f.j)});this.ta.push(d);Wa(this.ta,function(a,b){return xa(b.W.shapes[0])-xa(a.W.shapes[0])});
var e=1E4;v(this.ta,function(a){S(a.Na.div,"z-index",e);e++});this.Ta.addMarker(b)};Ad.prototype.r=function(a){var b=B(this.ta,function(b){return b.W==a});b&&(C(this.ta,b),this.Ta.removeMarker(b.Na))};Ad.prototype.D=n();Ad.prototype.m=function(a){a||qd(this.j)};function fd(){}o=fd.prototype;o.init=function(a,b){this.L=a;this.d=b;this.z=a.getContext("2d");this.z.lineWidth=1;this.Ya=m};
o.Sa=function(){var a=this,b=this.L;this.bb=N(this.L,Fd,function(c){c=Gd(c,b);if(a.Ya){a.B={x:c.x,y:c.y};a.z.clearRect(0,0,b.width,b.height);var c=a.B.x-a.f.x,d=a.B.y-a.f.y;a.z.strokeStyle="#000000";a.z.strokeRect(a.f.x+0.5,a.f.y+0.5,c,d);a.z.strokeStyle="#ffffff";0<c&&0<d?a.z.strokeRect(a.f.x+1.5,a.f.y+1.5,c-2,d-2):0<c&&0>d?a.z.strokeRect(a.f.x+1.5,a.f.y-0.5,c-2,d+2):0>c&&0>d?a.z.strokeRect(a.f.x-0.5,a.f.y-0.5,c+2,d+2):a.z.strokeRect(a.f.x-0.5,a.f.y+1.5,c+2,d-2)}});this.zb=N(b,Hd,function(c){var d=
Gd(c,b),f=a.getShape(),c=c.H?c.H:c;a.Ya=m;f?a.d.fireEvent(ld,{mouseEvent:c,shape:f,viewportBounds:a.getViewportBounds()}):(a.d.fireEvent(md),Id&&(c=a.d.Ja(d.x,d.y),0<c.length&&a.d.m(c[0])))})};o.Xa=function(){this.bb&&(lc(this.bb),delete this.bb);this.zb&&(lc(this.zb),delete this.gc)};o.getName=function(){return"rect_drag"};o.getSupportedShapeType=function(){return"rect"};
o.startSelection=function(a,b){var c={x:a,y:b};this.Ya=k;this.Sa(c);this.f=new na(a,b);this.d.fireEvent(Jd,{offsetX:a,offsetY:b});S(document.body,"-webkit-user-select","none")};o.stopSelection=function(){this.Xa();this.z.clearRect(0,0,this.L.width,this.L.height);S(document.body,"-webkit-user-select","auto");delete this.B};
o.getShape=function(){if(this.B&&3<Math.abs(this.B.x-this.f.x)&&3<Math.abs(this.B.y-this.f.y)){var a=this.getViewportBounds(),b=this.d.Ra({x:a.left,y:a.top}),a=this.d.Ra({x:a.right-1,y:a.bottom-1});return new sa("rect",new ra(b.x,b.y,a.x-b.x,a.y-b.y))}};o.getViewportBounds=function(){var a,b;this.B.x>this.f.x?(a=this.B.x,b=this.f.x):(a=this.f.x,b=this.B.x);var c,d;this.B.y>this.f.y?(c=this.f.y,d=this.B.y):(c=this.B.y,d=this.f.y);return{top:c,right:a,bottom:d,left:b}};
o.drawShape=function(a,b,c){if("rect"==b.type){var d;c?(c="#fff000",d=1.2):(c="#ffffff",d=1);b=b.geometry;a.strokeStyle="#000000";a.lineWidth=d;a.strokeRect(b.x+0.5,b.y+0.5,b.width+1,b.height+1);a.strokeStyle=c;a.strokeRect(b.x+1.5,b.y+1.5,b.width-1,b.height-1)}};function Kd(a,b,c){this.src=a;this.text=b;this.shapes=[c];this.context=document.URL};function Ld(a){for(var b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:c,left:b}}function Md(a){window.addEventListener?window.addEventListener("load",a):window.attachEvent&&window.attachEvent("onload",a)};function Y(){this.A=[new od];xd&&this.A.push(new Bd);this.ua=[];var a=this;Md(function(){v(a.A,function(a){a.init()});v(a.ua,function(b){b.initPlugin&&b.initPlugin(a);v(a.A,function(a){a.hb(b)})})})}function Z(a,b){return B(a.A,function(a){return P(a,b)})}o=Y.prototype;o.S=function(a,b){var c=h,d=h;t(a)?(c=a,d=b):u(a)&&(d=a);if(c){var f=Z(this,c);f&&f.S(c,d)}else v(this.A,function(a){a.S(d)})};o.t=function(a,b){var c=Z(this,a.src);c&&c.t(a,b)};o.h=function(a,b){v(this.A,function(c){c.h(a,b)})};
o.hb=function(a,b){try{this.ua.push(new window.annotorious.plugin[a](b))}catch(c){console.log("Could not load plugin: "+a)}};o.X=function(a){var b=Z(this,a);if(b)return b.X(a)};o.D=function(a){if(a){var b=Z(this,a);return b?b.D(a):[]}var c=[];v(this.A,function(a){Ta(c,a.D())});return c};o.Y=function(a){var b=Z(this,a);return b?b.Y(a):[]};o.O=function(a){if(a){var b=Z(this,a);b&&b.O(a)}else v(this.A,function(a){a.O()})};o.I=function(a){if(a){var b=Z(this,a);b&&b.I(a)}else v(this.A,function(a){a.I()})};
o.m=function(a){if(a){var b=Z(this,a.src);b&&b.m(a)}else v(this.A,function(a){a.m()})};o.nb=function(a){var b=B(this.A,function(b){return b.rb(a)});if(b)b.nb(a);else throw"Error: Annotorious does not support this media type in the current version or build configuration.";};o.dc=function(a){var b=this;v(this.D(a),function(a){b.r(a)})};o.r=function(a){var b=Z(this,a.src);b&&b.r(a)};o.ga=function(a,b){var c=Z(this,a);c&&c.ga(a,b)};o.ma=function(a,b){var c=Z(this,a);c&&c.ma(a,b)};
o.ec=function(a){a?this.K():this.I()};o.na=function(a){if(a){var b=Z(this,a);b&&b.na(a)}else v(this.A,function(a){a.na()})};o.K=function(a){if(a){var b=Z(this,item_url);b&&b.K(a)}else v(this.A,function(a){a.K()})};window.anno=new Y;Y.prototype.activateSelector=Y.prototype.S;Y.prototype.addAnnotation=Y.prototype.t;Y.prototype.addHandler=Y.prototype.h;Y.prototype.addPlugin=Y.prototype.hb;Y.prototype.getActiveSelector=Y.prototype.X;Y.prototype.getAnnotations=Y.prototype.D;
Y.prototype.getAvailableSelectors=Y.prototype.Y;Y.prototype.hideAnnotations=Y.prototype.O;Y.prototype.hideSelectionWidget=Y.prototype.I;Y.prototype.highlightAnnotation=Y.prototype.m;Y.prototype.makeAnnotatable=Y.prototype.nb;Y.prototype.removeAll=Y.prototype.dc;Y.prototype.removeAnnotation=Y.prototype.r;Y.prototype.setActiveSelector=Y.prototype.ma;Y.prototype.showAnnotations=Y.prototype.na;Y.prototype.showSelectionWidget=Y.prototype.K;Y.prototype.addSelector=Y.prototype.ga;
Y.prototype.setSelectionEnabled=Y.prototype.ec;var Nd;(Nd="ScriptEngine"in q&&"JScript"==q.ScriptEngine())&&(q.ScriptEngineMajorVersion(),q.ScriptEngineMinorVersion(),q.ScriptEngineBuildVersion());function Sd(a,b){this.C=Nd?[]:"";a!=l&&this.append.apply(this,arguments)}Sd.prototype.set=function(a){this.clear();this.append(a)};Nd?(Sd.prototype.jb=0,Sd.prototype.append=function(a,b,c){b==l?this.C[this.jb++]=a:(this.C.push.apply(this.C,arguments),this.jb=this.C.length);return this}):Sd.prototype.append=function(a,b,c){this.C+=a;if(b!=l)for(var d=1;d<arguments.length;d++)this.C+=arguments[d];return this};Sd.prototype.clear=function(){Nd?this.jb=this.C.length=0:this.C=""};
Sd.prototype.toString=function(){if(Nd){var a=this.C.join("");this.clear();a&&this.append(a);return a}return this.C};/*
 Portions of this code are from the google-caja project, received by
 Google under the Apache license (http://code.google.com/p/google-caja/).
 All other code is Copyright 2009 Google, Inc. All Rights Reserved.

 // Copyright (C) 2006 Google Inc.
 //
 // Licensed under the Apache License, Version 2.0 (the "License");
 // you may not use this file except in compliance with the License.
 // You may obtain a copy of the License at
 //
 //      http://www.apache.org/licenses/LICENSE-2.0
 //
 // Unless required by applicable law or agreed to in writing, software
 // distributed under the License is distributed on an "AS IS" BASIS,
 // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 // See the License for the specific language governing permissions and
 // limitations under the License.

*/
function Td(){}
var Ud={mc:"<",lc:">",ic:"&",nc:"\u00a0",pc:'"',jc:"'"},$={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:20,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,noframes:20,noscript:20,object:16,
ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:20,select:0,small:0,span:0,strike:0,strong:0,style:20,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0},Vd=/&/g,Wd=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,Xd=/</g,Yd=/>/g,Zd=/\"/g,$d=/=/g,ae=/\0/g,be=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g,ce=/^#(\d+)$/,de=/^#x([0-9A-Fa-f]+)$/,ee=RegExp("^\\s*(?:(?:([a-z][a-z-]*)(\\s*=\\s*(\"[^\"]*\"|'[^']*'|(?=[a-z][a-z-]*\\s*=)|[^>\"'\\s]*))?)|(/?>)|[^a-z\\s>]+)",
"i"),fe=RegExp("^(?:&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);|<[!]--[\\s\\S]*?--\>|<!\\w[^>]*>|<\\?[^>*]*>|<(/)?([a-z][a-z0-9]*)|([^<&>]+)|([<&>]))","i");
Td.prototype.parse=function(a,b){var c=l,d=m,f=[],e,g,j;a.F=[];for(a.T=m;b;){var i=b.match(d?ee:fe),b=b.substring(i[0].length);if(d)if(i[1]){var p=i[1].toLowerCase();if(i[2]){i=i[3];switch(i.charCodeAt(0)){case 34:case 39:i=i.substring(1,i.length-1)}i=i.replace(ae,"").replace(be,ka(this.bc,this))}else i=p;f.push(p,i)}else i[4]&&(g!==h&&(j?a.Rb&&a.Rb(e,f):a.Gb&&a.Gb(e)),j&&g&12&&(c=c===l?b.toLowerCase():c.substring(c.length-b.length),d=c.indexOf("</"+e),0>d&&(d=b.length),g&4?a.Db&&a.Db(b.substring(0,
d)):a.Pb&&a.Pb(b.substring(0,d).replace(Wd,"&amp;$1").replace(Xd,"&lt;").replace(Yd,"&gt;")),b=b.substring(d)),e=g=j=h,f.length=0,d=m);else if(i[1])ge(a,i[0]);else if(i[3])j=!i[2],d=k,e=i[3].toLowerCase(),g=$.hasOwnProperty(e)?$[e]:h;else if(i[4])ge(a,i[4]);else if(i[5])switch(i[5]){case "<":ge(a,"&lt;");break;case ">":ge(a,"&gt;");break;default:ge(a,"&amp;")}}for(c=a.F.length;0<=--c;)a.P.append("</",a.F[c],">");a.F.length=0};
Td.prototype.bc=function(a){a=a.toLowerCase();if(Ud.hasOwnProperty(a))return Ud[a];var b=a.match(ce);return b?String.fromCharCode(parseInt(b[1],10)):(b=a.match(de))?String.fromCharCode(parseInt(b[1],16)):""};function he(){};/*
 Portions of this code are from the google-caja project, received by
 Google under the Apache license (http://code.google.com/p/google-caja/).
 All other code is Copyright 2009 Google, Inc. All Rights Reserved.

 // Copyright (C) 2006 Google Inc.
 //
 // Licensed under the Apache License, Version 2.0 (the "License");
 // you may not use this file except in compliance with the License.
 // You may obtain a copy of the License at
 //
 //      http://www.apache.org/licenses/LICENSE-2.0
 //
 // Unless required by applicable law or agreed to in writing, software
 // distributed under the License is distributed on an "AS IS" BASIS,
 // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 // See the License for the specific language governing permissions and
 // limitations under the License.

*/
function ie(a,b){var c=new Sd;(new Td).parse(new je(c,b,h),a);return c.toString()}function je(a,b,c){this.P=a;this.F=[];this.T=m;this.Tb=b;this.Oa=c}ma(je,he);
var ke={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"*::accesskey":0,"*::tabindex":0,"*::onfocus":2,"*::onblur":2,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,
"area::href":1,"area::nohref":0,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,
"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,
"img::hspace":0,"img::ismap":0,"img::longdesc":1,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::autocomplete":0,"input::align":0,"input::alt":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,
"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,
"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,
"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,
"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0};
je.prototype.Rb=function(a,b){if(!this.T&&$.hasOwnProperty(a)){var c=$[a];if(!(c&32))if(c&16)this.T=!(c&2);else{for(var d=b,f=0;f<d.length;f+=2){var e=d[f],g=d[f+1],j=l,i;if((i=a+"::"+e,ke.hasOwnProperty(i))||(i="*::"+e,ke.hasOwnProperty(i)))j=ke[i];if(j!==l)switch(j){case 0:break;case 2:case 3:g=l;break;case 4:case 5:case 6:case 7:case 8:case 9:g=this.Oa?this.Oa(g):g;break;case 1:g=this.Tb&&this.Tb(g);break;case 11:g&&"#"===g.charAt(0)?(g=this.Oa?this.Oa(g):g)&&(g="#"+g):g=l;break;default:g=l}else g=
l;d[f+1]=g}if(b=d){c&2||this.F.push(a);this.P.append("<",a);c=0;for(d=b.length;c<d;c+=2)f=b[c],e=b[c+1],e!==l&&e!==h&&this.P.append(" ",f,'="',e.replace(Vd,"&amp;").replace(Xd,"&lt;").replace(Yd,"&gt;").replace(Zd,"&#34;").replace($d,"&#61;"),'"');this.P.append(">")}}}};
je.prototype.Gb=function(a){if(this.T)this.T=m;else if($.hasOwnProperty(a)){var b=$[a];if(!(b&50)){if(b&1)for(b=this.F.length;0<=--b;){var c=this.F[b];if(c===a)break;if(!($[c]&1))return}else for(b=this.F.length;0<=--b&&!(this.F[b]===a););if(!(0>b)){for(var d=this.F.length;--d>b;)c=this.F[d],$[c]&1||this.P.append("</",c,">");this.F.length=b;this.P.append("</",a,">")}}}};function ge(a,b){a.T||a.P.append(b)}je.prototype.Pb=function(a){this.T||this.P.append(a)};je.prototype.Db=function(a){this.T||this.P.append(a)};function gd(a){this.element=Q(le);this.d=a;this.Wb=a.getItem();this.za=R(".annotorious-editor-text",this.element)[0];this.Ub=R(".annotorious-editor-button-cancel",this.element)[0];this.sb=R(".annotorious-editor-button-save",this.element)[0];this.Vb=Xb(this.sb);this.pa=[];var b=this;N(this.Ub,"click",function(c){c.preventDefault();a.stopSelection(b.Ab);b.close()});N(this.sb,"click",function(c){c.preventDefault();c=b.Hb();a.t(c);a.stopSelection();b.Ab?a.fireEvent(me,c):a.fireEvent(ne,c);b.close()});
W(this.element,m);a.element.appendChild(this.element);this.za.focus()}o=gd.prototype;o.gb=function(a){var b=Rb("div","annotorious-editor-field");t(a)?b.innerHTML=a:u(a)?this.pa.push({v:b,kb:a}):Wb(a)&&b.appendChild(a);a=this.Vb;a.parentNode&&a.parentNode.insertBefore(b,a)};o.open=function(a){if(this.Ea=this.Ab=a)this.za.value=a.text;W(this.element,k);this.za.focus();v(this.pa,function(b){var c=b.kb(a);t(c)?b.v.innerHTML=c:Wb(c)&&(Ub(b.v),b.v.appendChild(c))})};
o.close=function(){W(this.element,m);this.za.value=""};o.aa=function(a){Gc(this.element,a.x,a.y)};o.Hb=function(){var a=ie(this.za.value,function(a){return a});this.Ea?this.Ea.text=a:this.Ea=new Kd(this.Wb.src,a,this.d.X().getShape());return this.Ea};gd.prototype.addField=gd.prototype.gb;gd.prototype.getAnnotation=gd.prototype.Hb;function cd(){this.qa=[]}function Gd(a,b){var c=m;return c=!a.offsetX||!a.offsetY&&a.H.changedTouches?{x:a.H.changedTouches[0].clientX-Ld(b).left,y:a.H.changedTouches[0].clientY-Ld(b).top}:{x:a.offsetX,y:a.offsetY}}cd.prototype.h=function(a,b){this.qa[a]||(this.qa[a]=[]);this.qa[a].push(b)};cd.prototype.ka=function(a,b){var c=this.qa[a];c&&C(c,b)};cd.prototype.fireEvent=function(a,b){var c=m,d=this.qa[a];d&&v(d,function(a){a=a(b);a!==h&&!a&&(c=k)});return c};
var jd="onMouseOverItem",kd="onMouseOutOfItem",sd="onMouseOverAnnotation",ud="onMouseOutOfAnnotation",Jd="onSelectionStarted",md="onSelectionCanceled",ld="onSelectionCompleted",td="beforePopupHide",ne="onAnnotationCreated",me="onAnnotationUpdated",oe={};function id(a,b,c){var d=this;c||(c="Click and Drag to Annotate");this.element=Q(pe,{pb:c});this.d=a;this.wb=R(".annotorious-hint-msg",this.element)[0];this.vb=R(".annotorious-hint-icon",this.element)[0];this.eb=function(){d.show()};this.cb=function(){qe(d)};this.Sa();qe(this);b.appendChild(this.element)}
id.prototype.Sa=function(){var a=this;this.yb=N(this.vb,"mouseover",function(){a.show();window.clearTimeout(a.Za)});this.xb=N(this.vb,"mouseout",function(){qe(a)});this.d.h(jd,this.eb);this.d.h(kd,this.cb)};id.prototype.Xa=function(){lc(this.yb);lc(this.xb);this.d.ka(jd,this.eb);this.d.ka(kd,this.cb)};id.prototype.show=function(){window.clearTimeout(this.Za);V(this.wb,0.8);var a=this;this.Za=window.setTimeout(function(){qe(a)},3E3)};function qe(a){window.clearTimeout(a.Za);V(a.wb,0)};var re="ontouchstart"in window,Fd=re?"touchmove":"mousemove",Hd=re?"touchend":"mouseup",Id=re;re&&zb(document.getElementsByTagName("html")[0],"hasTouch");window.annotorious||(window.annotorious={});window.annotorious.plugin||(window.annotorious.plugin={});function X(a){this.element=Q(se);this.d=a;this.Xb=R(".annotorious-popup-text",this.element)[0];this.G=R(".annotorious-popup-buttons",this.element)[0];this.Wa=m;this.pa=[];var b=R(".annotorious-popup-button-edit",this.G)[0],c=R(".annotorious-popup-button-delete",this.G)[0],d=this;N(b,"mouseover",function(){zb(b,"annotorious-popup-button-active")});N(b,"mouseout",function(){Bb(b,"annotorious-popup-button-active")});N(b,"click",function(){V(d.element,0);S(d.element,"pointer-events","none");a.Fb(d.c)});
N(c,"mouseover",function(){zb(c,"annotorious-popup-button-active")});N(c,"mouseout",function(){Bb(c,"annotorious-popup-button-active")});N(c,"click",function(){a.fireEvent("beforeAnnotationRemoved",d.c)||(V(d.element,0),S(d.element,"pointer-events","none"),a.fireEvent("onAnnotationRemoved",d.c),a.r(d.c))});N(this.element,"mouseover",function(){window.clearTimeout(d.Va);0.9>(d.G.style[Na("opacity")]||"")&&V(d.G,0.9);vd(d)});N(this.element,"mouseout",function(){V(d.G,0);qd(d)});a.h(oe.fc,function(){qd(d)});
V(this.G,0);V(this.element,0);S(this.element,"pointer-events","none");a.element.appendChild(this.element)}X.prototype.gb=function(a){var b=Rb("div","annotorious-popup-field");t(a)?b.innerHTML=a:u(a)?this.pa.push({v:b,kb:a}):Wb(a)&&b.appendChild(a);this.element.appendChild(b)};function qd(a){a.Wa=m;a.va||(a.va=window.setTimeout(function(){a.d.fireEvent(td,a);a.Wa||(V(a.element,0),S(a.element,"pointer-events","none"),V(a.G,0.9),delete a.va)},300))}
function vd(a){a.Wa=k;a.va&&(window.clearTimeout(a.va),delete a.va)}X.prototype.show=function(a,b){vd(this);b&&this.aa(b);a&&Ed(this,a);this.Va&&window.clearTimeout(this.Va);V(this.G,0.9);var c=this;this.Va=window.setTimeout(function(){V(c.G,0)},1E3);V(this.element,0.9);S(this.element,"pointer-events","auto")};X.prototype.aa=function(a){Gc(this.element,new Eb(a.x,a.y))};
function Ed(a,b){a.c=b;a.Xb.innerHTML=b.text?b.text.replace(/\n/g,"<br/>"):'<span class="annotorious-popup-empty">No comment</span>';"editable"in b&&b.editable==m?W(a.G,m):W(a.G,k);v(a.pa,function(a){var d=a.kb(b);t(d)?a.v.innerHTML=d:Wb(d)&&(Ub(a.v),a.v.appendChild(d))})}X.prototype.addField=X.prototype.gb;D&&J(8);function te(a){return"object"===typeof a&&a&&0===a.kc?a.content:(""+a).replace(ue,ve)}var we={"\x00":"&#0;",'"':"&quot;","&":"&amp;","'":"&#39;","<":"&lt;",">":"&gt;","\t":"&#9;","\n":"&#10;","\x0B":"&#11;","\u000c":"&#12;","\r":"&#13;"," ":"&#32;","-":"&#45;","/":"&#47;","=":"&#61;","`":"&#96;","\u0085":"&#133;","\u00a0":"&#160;","\u2028":"&#8232;","\u2029":"&#8233;"};function ve(a){return we[a]}var ue=/[\x00\x22\x26\x27\x3c\x3e]/g;function se(){return'<div class="annotorious-popup top-left" style="position:absolute;z-index:1"><div class="annotorious-popup-buttons"><a class="annotorious-popup-button annotorious-popup-button-edit" title="Edit" href="javascript:void(0);">EDIT</a><a class="annotorious-popup-button annotorious-popup-button-delete" title="Delete" href="javascript:void(0);">DELETE</a></div><span class="annotorious-popup-text"></span></div>'}
function le(){return'<div class="annotorious-editor" style="position:absolute;z-index:1"><form><textarea class="annotorious-editor-text" placeholder="Add a Comment..." tabindex="1"></textarea><div class="annotorious-editor-button-container"><a class="annotorious-editor-button annotorious-editor-button-cancel" href="javascript:void(0);" tabindex="3">Cancel</a><a class="annotorious-editor-button annotorious-editor-button-save" href="javascript:void(0);" tabindex="2">Save</a></div></form></div>'};function ed(a){return'<canvas class="annotorious-item annotorious-opacity-fade" style="position:absolute; top:0px; left:0px; width:'+te(a.width)+"px; height:"+te(a.height)+'px; z-index:0" width="'+te(a.width)+'" height="'+te(a.height)+'"></canvas>'}
function pe(a){return'<div class="annotorious-hint" style="white-space:nowrap; position:absolute; top:0px; left:0px; pointer-events:none;"><div class="annotorious-hint-msg annotorious-opacity-fade">'+te(a.pb)+'</div><div class="annotorious-hint-icon" style="pointer-events:auto"></div></div>'};function zd(a){return'<div class="annotorious-opacity-fade" style="white-space:nowrap; position:absolute; pointer-events:none; top:80px; width:100%; text-align:center;"><div class="annotorious-ol-hint" style="width: 400px; margin:0px auto;">'+te(a.pb)+"</dvi></div>"};
